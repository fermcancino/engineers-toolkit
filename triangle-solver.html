<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Triangle Solver</title>
  <style>
    * {
      margin:0; 
      padding:0; 
      box-sizing:border-box; 
      font-family:'Poppins',sans-serif; 
      transition:background-color 0.3s, color 0.3s;
    }
    body {
      height:100vh; 
      display:flex;
      flex-direction: column; 
      justify-content:center; 
      align-items:center; 
      background:#1e1e1e; 
      color:#fff;
      margin: 0;
      padding: 0;
    }
    .light {
      background:#e0e0e0; 
      color:#333;
    }

    /* Topbar */
    .topbar {
      width: 100%;
      max-width: 450px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 40px;
      margin-bottom: 20px;
      font-size: 1.2em;
      font-weight: bold;
      background: linear-gradient(135deg, #3a3a3a, #1e1e1e);
      color: #fff;
      border-radius: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
      letter-spacing: 1px;
    }
    .light .topbar {
      background:linear-gradient(135deg,#f1f1f1,#d8d8d8); 
      color:#222;
    }
    /* Theme Toggle */
    .switch {
      width: 50px;
      height: 28px;
      background-color: #555;
      box-shadow: 0 2px 6px rgba(255,255,255,0.15);
      border-radius: 30px;
      position: relative;
      transition: background-c0lor 0.3s ease;
      display: flex;
      align-items: center;
      padding: 2px;
      cursor: pointer;
    }

    .slider {
      width: 24px;
      height: 24px;
      background: white;
      border-radius: 50%;
      transition: all 0.3s ease;
      transform: translateX(0);
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }

    body.light .switch {
      background: #f0f0f0;
      border: 1px solid #bbb;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }

    body.light .switch .slider {
      transform: translateX(20px);
    }
    /* Carousel */
    .carousel-container {
      width: 95%;
      max-width: 420px;
      height: 520px;
      perspective: 1200px;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      margin: 20px auto;
    }
    .carousel {
      width:100%; 
      height:100%; 
      position:relative; 
      transform-style:preserve-3d;
      transition:transform 0.8s; 
      transform: translateZ(-175px);
    }
    .card {
      position:absolute; 
      width:100%; 
      height:100%; 
      border-radius:30px; 
      background:#2a2a2a;
      box-shadow:8px 8px 18px rgba(0,0,0,0.6), -8px -8px 18px rgba(70,70,70,0.4);
      padding:25px; 
      display:flex; 
      flex-direction:column; 
      justify-content:center;
      align-items:center; 
      backface-visibility:hidden; 
      opacity:0.4; 
      transition:opacity 0.4s ease;
    }
    .card.active {
      opacity:1;
    }
    .light .card {
      background:#e0e0e0; 
      box-shadow:8px 8px 18px #b8b9be, 
                -8px -8px 18px #ffffff;
    }
    .card h1 {
      font-size:1.1em; 
      letter-spacing: 1px;
      margin-bottom:20px; 
      text-align:center; 
    }
     

    .input-group {
      margin:15px 10; 
      width:90%;
    }
    input {
      width:90%; 
      padding:12px; 
      font-size:1.2em; 
      text-align:center; 
      border:none; 
      outline:none; 
      border-radius:15px;
      box-shadow:inset 4px 4px 6px #141414, 
                 inset -4px -4px 6px #3a3a3a; 
      background:#3a3a3a; color:#fff;
    }
    .light input {
      background:#f3f3f3; 
      color:#222; 
      box-shadow:inset 4px 4px 6px #b8b9be, 
                 inset -4px -4px 6px #ffffff;
    }
    input::placeholder {
      color:#aaa;
    }

    
    .buttons-row {
      display:flex; 
      justify-content:center; 
      gap:15px; 
      margin-top:15px; 
    }
    button {
      min-width:90px; 
      flex:1; 
      padding:12px; 
      font-size:1.1em; 
      border:none; 
      border-radius:25px; 
      cursor:pointer; 
      background:#2a2a2a; 
      color:inherit;
      box-shadow:4px 4px 6px #141414, -4px -4px 6px #3a3a3a; 
      transition:transform 0.2s;
    }
    .light button {
      background:#e0e0e0; 
      box-shadow:4px 4px 6px #b8b9be, 
                -4px -4px 6px #ffffff;
    }
    button:hover {     
      box-shadow:         
        inset 3px 3px 6px rgba(0,0,0,0.6),
        inset -3px -3px 6px rgba(255,255,255,0.1);
      transform: translateY(-2px);
      
    }
    .light button:hover {
      box-shadow: 
        inset 3px 3px 6px rgba(0,0,0,0.6),
        inset -3px -3px 6px rgba(255,255,255,0.1);
    }
    button:active {
      animation:bounce3D 0.4s ease forwards; 
      box-shadow: 
        0 0 12px rgba(79,172,254,0.9),
        inset 3px 3px 6px rgba(0,0,0,0.6),
        inset -3px -3px 6px rgba(255,255,255,0.1);
    }
    .light button:active {
      animation:bounce3D 0.4s ease forwards; 
      box-shadow: 
        0 0 12px rgba(79,172,254,0.9),
        inset 3px 3px 6px rgba(0,0,0,0.6),
        inset -3px -3px 6px rgba(255,255,255,0.1);}
  
    .btn-clr:active {
      box-shadow: 
        0 0 12px rgba(255, 128, 128, 0.9),  
        inset 3px 3px 6px rgba(0, 0, 0, 0.6),
        inset -3px -3px 6px rgba(255, 128, 128, 0.2) !important; 
      animation: bounce3D 0.3s ease;
    }
  
    .button-two {
      display: flex;
      width: 100%;
      gap: 20px;
      margin: 20px auto;
    }

    .button-two button {
      flex: 1;
    }
      
    @keyframes bounce3D {
      0%{transform:scale(1);}
      50%{transform:scale(1.08);}
      100%{transform:scale(1);}
    }

    .result-field {
      margin-top:10px; 
      width:100%; 
      padding:10px; 
      font-size:1.1em; 
      border-radius:25px; 
      border:1px solid #00c6ff;
      box-shadow:0 0 7px #00bcd4;
       color:#000; 
      font-weight:bold;
      display: block;
      justify-content:center;
      align-items:center;
      text-align:center;
      height:160px; 
      background:#3a3a3a; color:#fff;
      resize: none;
      overflow-x: hidden;
      overflow-y: auto; 
      white-space: pre-wrap;
      line-height: 1.35;
    }
    .light .result-field {
      border:1px solid #00aaff;
      color: black;
      box-shadow:0 0 7px #00bcd4;
      background:#f3f3f3;
    }
    
    .result-flash { 
      font-weight:bold; 
      border:2px solid #00c6ff; 
      box-shadow:0 0 10px rgba(0, 255, 128, 0.7); 
      animation:bounce3D 0.4s ease forwards;
    }
    
    .light .result-flash { 
      font-weight:bold; 
      border:2px solid #00c6ff; 
      box-shadow:0 0 10px rgba(0, 255, 128, 0.7);
     }

    .input-flash {
      font-weight: bold;
      border: 2px solid transparent;
      border-image: linear-gradient(45deg, #00c6ff, #0072ff);
      border-image-slice: 1;
      box-shadow: 0 0 10px rgba(0, 198, 255, 0.7);
      animation: bounce3D 0.4s ease forwards;
    }

    .light .input-flash {
      border-image: linear-gradient(45deg, #00c6ff, #1aff8c);
      box-shadow: 0 0 10px rgba(0, 198, 255, 0.7), 0 0 15px rgba(26, 255, 140, 0.5);
    }

    
    .input-flash {
      border-image: linear-gradient(45deg, #1aff8c, #00c6ff);
      box-shadow: 0 0 12px rgba(0, 198, 255, 0.9), 0 0 18px rgba(26, 255, 140, 0.7);
    }
       
    .controls {
      position:absolute; 
      bottom:-60px; 
      width:100%; 
      display:flex; 
      justify-content:space-between;
    }
    .controls button {
      width:50px; 
      height:50px; 
      border-radius:50%; 
      font-size:1.5em;
    }
    .controls button:active {
      animation: bounce3D 0.4s ease forwards;
      box-shadow: 
        0 0 12px rgba(0, 255, 128, 0.9),
        inset 3px 3px 6px rgba(0, 0, 0, 0.6),
        inset -3px -3px 6px rgba(0, 255, 128, 0.2);
      transform: translateY(-2px);
    }

    .input-error {
      border:2px solid #ff6b6b !important; 
      box-shadow:0 0 8px rgba(255,107,107,0.8); 
    }
    .light .input-error {
      border:2px solid #ff6b6b !important; 
      box-shadow:0 0 8px rgba(255,107,107,0.8); 
    }
    .error-message {
      color:#ff6b6b ; 
      font-size:0.80em; 
      margin-top:4px; 
      text-align:center; 
      opacity:0; 
      transition:opacity 0.3s;
    }
    .show-error {
      opacity:1;
    }
    .shake {
      animation:shake 0.3s;
    }
    @keyframes shake {
        0%{transform:translateX(0);}
        25%{transform:translateX(-5px);}
        50%{transform:translateX(5px);}
        75%{transform:translateX(-5px);}
        100%{transform:translateX(0);}
    }
    input.input-error::placeholder {
      color: #ff8a8a;
    }

    select {
      background: #3a3a3a;
      color: inherit;
      border: none;
      border-radius: 12px;
      padding: 9px 16px;
      font-size: 1em;
      letter-spacing: 1px;
      box-shadow: 
        inset 4px 4px 6px #141414, 
        inset -4px -4px 6px #3a3a3a;
    }
    .light select {
      background: #f3f3f3;
      color: #222;
      box-shadow: inset 4px 4px 6px #b8b9be, inset -4px -4px 6px #ffffff;
    }
    
    .input-one {
    display: flex;
    gap: 10px; 
    align-items: center;
    margin-top: 10px;
    flex-direction: row;
    }

    .input-one input {
    flex: 1;
    padding: 10px;
    border-radius: 13px;
    font-size: 1.1em;
    max-width: 150px;
    }
    .angle {
    display: flex;
    gap: 10px; 
    align-items: center;
    margin-top: 10px;
    flex-direction: row;
    }

    .angle input {
    flex: 1;
    padding: 10px;
    border-radius: 13px;
    font-size: 0.95em;
    max-width: 140px;
    
    }

    .angle-group {
    display: flex;
    align-items: center;
    gap: 8px;
    }

    .angle-group select {
    width: 140px;
    font-size: 1.1em;
    padding: 9px;
    }

    .angle-group input {
    flex: 1;
    }

    .formula-box {
    background: rgba(255, 255, 255, 0.12);
    border-left: 4px solid rgba(0, 122, 204, 0.8); 
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    padding: 12px;
    margin-bottom: 10px;
    font-family: monospace;
    font-size: 18px;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    color: #e8f0f6; 
    transition: all 0.3s ease;
    }

    .light .formula-box {
    background: rgba(255, 255, 255, 0.6);
    border-left: 4px solid rgba(0, 122, 204, 0.8);
    color: #1a1a1a;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    }
    .formula-box:hover {
    border-left-color: #00c6ff;
    box-shadow: 0 4px 25px rgba(0, 198, 255, 0.4);
    }
    .formula-box::after {
    content: "";
    position: absolute;
    top: 0;
    left: -75%;
    width: 50%;
    height: 100%;
    background: linear-gradient(
        120deg,
        transparent,
        rgba(255, 255, 255, 0.3),
        transparent
    );
    transform: skewX(-25deg);
    animation: shimmer 4s infinite;
    }

    @keyframes shimmer {
    0% { left: -75%; }
    60% { left: 125%; }
    100% { left: 125%; }
    }
    .highlight {
        border: 2px solid #007bff; 
    }
  </style>
</head>
<body class="dark">
  <div class="topbar">
    <div>Triangle Solver</div>
    <div id="themeToggle" class="switch">
      <div class="slider"></div>
    </div>
  </div>

 <div class="carousel-container">
  <div class="carousel" id="carousel">

    <!-- Card 1: Pythagorean Theorem -->
    <div class="card">
      <h1>Right Triangle Solver<br>(Pythagorean Theorem)</h1>
      <div class="formula-box">
        <strong>Formula:</strong><br>
        c² = a² + b²
      </div>
      <div class="input-one">
        <input type="number" id="pythA" placeholder="Side a" step="any">
        <input type="number" id="pythB" placeholder="Side b" step="any">
        <input type="number" id="pythC" placeholder="Side c" step="any">
      </div>
      <textarea id="pythResult" class="result-field" placeholder="Solutions will appear here" readonly></textarea>
      <div class="button-two">
        <button onclick="solvePythagorean()">Solve</button>
        <button class="btn-clr" onclick="clearPythagorean()">Clear</button>
      </div>
    </div>

    <!-- Card 2: Right Triangle Trigonometry -->
    <div class="card">
      <h1>Right Triangle Solver<br>(Trigonometric Ratios)</h1>
      <div class="formula-box">
        <strong>Formulas:</strong><br>
        sin(A) = a / c<br>
        cos(A) = b / c<br>
        tan(A) = a / b
      </div>
      <div class="input-one">
        <input type="number" id="trigA" placeholder="Side a" step="any">
        <input type="number" id="trigB" placeholder="Side b" step="any">
        <input type="number" id="trigC" placeholder="Side c" step="any">
      </div>
      <div class="input-one">
         <div class="angle-group">
         <select id="trig-function">
          <option value="sin">sin</option>
          <option value="cos">cos</option>
          <option value="tan">tan</option>
         </select>
        <input type="number" id="trigAngleA" placeholder="Angle A (°)" step="any">
       </div>
      </div>
      
      <textarea id="trigResult" class="result-field" placeholder="Solutions will appear here" readonly></textarea>
      <div class="button-two">
        <button onclick="solveTrigRatios()">Solve</button>
        <button class="btn-clr" onclick="clearTrigRatios()">Clear</button>
      </div>
    </div>

    <!-- Card 3: Oblique Triangle - Law of Sines -->
    <div class="card">
      <h1>Oblique Triangle Solver<br>(Law of Sines)</h1>
      <div class="formula-box">
        <strong>Formula:</strong><br>
        a / sin(A) = b / sin(B) = c / sin(C)
      </div>
      <div class="input-one">
        <input type="number" id="sineA" placeholder="Side a" step="any">
        <input type="number" id="sineB" placeholder="Side b" step="any">
        <input type="number" id="sineC" placeholder="Side c" step="any">
      </div>
      <div class="input-one">
        <div class="angle">
        <input type="number" id="sineAngleA" placeholder="Angle A (°)" step="any">
        <input type="number" id="sineAngleB" placeholder="Angle B (°)" step="any">
        <input type="number" id="sineAngleC" placeholder="Angle C (°)" step="any">
        </div>
      </div>
      <textarea id="sineResult" class="result-field" placeholder="Solutions will appear here" readonly></textarea>
      <div class="button-two">
        <button onclick="solveLawOfSines()">Solve</button>
        <button class="btn-clr" onclick="clearLawOfSines()">Clear</button>
      </div>
    </div>

    <!-- Card 4: Oblique Triangle - Law of Cosines -->
    <div class="card">
      <h1>Oblique Triangle Solver<br>(Law of Cosines)</h1>
      <div class="formula-box">
        <strong>Formulas:</strong><br>
        a² = b² + c² − 2bc·cos(A)<br>
        b² = a² + c² − 2ac·cos(B)<br>
        c² = a² + b² − 2ab·cos(C)
      </div>
      <div class="input-one">
        <input type="number" id="cosA" placeholder="Side a" step="any">
        <input type="number" id="cosB" placeholder="Side b" step="any">
        <input type="number" id="cosC" placeholder="Side c" step="any">
      </div>
      <div class="input-one">
         <div class="angle-group">
         <select id="angle-function">
          <option value="Angle A">Angle A (°)</option>
          <option value="Angle B">Angle B (°)</option>
          <option value="Angle C">Angle C (°)</option>
         </select>
        <input type="number" id="angle" placeholder="Angle (°)" step="any">
       </div>
      </div>
      <textarea id="cosResult" class="result-field" placeholder="Solutions will appear here" readonly></textarea>
      <div class="button-two">
        <button onclick="solveLawOfCosines()">Solve</button>
        <button class="btn-clr" onclick="clearLawOfCosines()">Clear</button>
      </div>
    </div>

  </div>

  <!-- Carousel Controls -->
  <div class="controls">
    <button onclick="prevCard()">‹</button>
    <button onclick="nextCard()">›</button>
  </div>
</div>

<script>
/* Carousel */
function updateCarouselLayout(){
  const carousel=document.getElementById('carousel');
  const cards=document.querySelectorAll('.card');
  const numCards=cards.length;
  const cardWidth=carousel.offsetWidth;
  const translateZ=Math.round((cardWidth/2)/Math.tan(Math.PI/numCards));
  const angleStep=360/numCards;
  let currentIndex=window.carouselData?window.carouselData.currentIndex:0;
  cards.forEach((card,index)=>{card.style.transform=`rotateY(${index*angleStep}deg) translateZ(${translateZ}px)`;});
  window.carouselData={translateZ,angleStep,currentIndex,total:numCards};
  const newAngle=-currentIndex*angleStep;
  carousel.style.transform=`translateZ(-${translateZ}px) rotateY(${newAngle}deg)`;
  cards.forEach((card,i)=>{card.classList.toggle('active',i===currentIndex);});
}
function nextCard(){rotateToIndex(window.carouselData.currentIndex+1);}
function prevCard(){rotateToIndex(window.carouselData.currentIndex-1);}
function rotateToIndex(index){
  const {translateZ,angleStep,total}=window.carouselData;
  window.carouselData.currentIndex=(index+total)%total;
  const newAngle=-window.carouselData.currentIndex*angleStep;
  document.getElementById('carousel').style.transform=`translateZ(-${translateZ}px) rotateY(${newAngle}deg)`;
  const cards=document.querySelectorAll('.card');
  cards.forEach((card,i)=>{card.classList.toggle('active',i===window.carouselData.currentIndex);});
}
window.addEventListener('load',updateCarouselLayout);
window.addEventListener('resize',updateCarouselLayout);
updateCarouselLayout();
/* Theme Toggle */
  themeToggle.addEventListener("click", () => {
  document.body.classList.toggle("light");
  });

// ==== Helpers ====
function showError(inputId, message) {
    const el = document.getElementById(inputId);
    const oldPlaceholder = el.placeholder;
    el.value = "";
    el.placeholder = message;
    el.classList.add("input-error", "shake");

    setTimeout(() => el.classList.remove("shake"), 500);
    setTimeout(() => {
        el.classList.remove("input-error");
        el.placeholder = oldPlaceholder;
    }, 2000);
}

// 🔹 Highlight effect for result field
function emphasizeResult(id) {
    const el = document.getElementById(id);
    el.classList.remove("result-flash");
    void el.offsetWidth; // trigger reflow
    el.classList.add("result-flash");
}

// 🔹 Highlight effect for solved input
function emphasizeInput(id) {
    const el = document.getElementById(id);
    el.classList.remove("input-flash");
    void el.offsetWidth; // trigger reflow
    el.classList.add("input-flash");
}
function scrollResultToBottom(id){
  const el = document.getElementById(id);
  el.scrollTop = el.scrollHeight;
}

// ==== CARD 1: Pythagorean Theorem ====
function solvePythagorean() {
    let aInput = document.getElementById("pythA");
    let bInput = document.getElementById("pythB");
    let cInput = document.getElementById("pythC");
    let result = document.getElementById("pythResult");

    let a = parseFloat(aInput.value);
    let b = parseFloat(bInput.value);
    let c = parseFloat(cInput.value);

    let steps = "";

    // if all blank
    if (isNaN(a) && isNaN(b) && isNaN(c)) {
        showError("pythA", "Enter a");
        showError("pythB", "Enter b");
        showError("pythC", "Enter c");
        result.value = "Enter any two sides to solve for the missing one.";
        return;
    }

    // Case 1: a and b known → solve c
    if (!isNaN(a) && !isNaN(b) && isNaN(c)) {
        c = Math.sqrt(a * a + b * b);
        cInput.value = c.toFixed(4);
        emphasizeInput("pythC"); 

        steps += `Given: a = ${a}, b = ${b}\n`;
        steps += `Formula: c² = a² + b²\n`;
        steps += `c² = ${(a*a).toFixed(4)} + ${(b*b).toFixed(4)}\n`;
        steps += `c² = ${(a*a + b*b).toFixed(4)}\n`;
        steps += `c = √(${(a*a + b*b).toFixed(4)}) = ${c.toFixed(4)}\n`;
    }
    // Case 2: a and c known → solve b
    else if (!isNaN(a) && !isNaN(c) && isNaN(b)) {
        if (c <= a) {
            showError("pythC", "c > a");
            result.value = "Error: c must be greater than a (hypotenuse > side).";
            return;
        }
        b = Math.sqrt(c * c - a * a);
        bInput.value = b.toFixed(4);
        emphasizeInput("pythB");

        steps += `Given: a = ${a}, c = ${c}\n`;
        steps += `Formula: b² = c² - a²\n`;
        steps += `b² = ${(c*c).toFixed(4)} - ${(a*a).toFixed(4)}\n`;
        steps += `b² = ${(c*c - a*a).toFixed(4)}\n`;
        steps += `b = √(${(c*c - a*a).toFixed(4)}) = ${b.toFixed(4)}\n`;
    }
    // Case 3: b and c known → solve a
    else if (!isNaN(b) && !isNaN(c) && isNaN(a)) {
        if (c <= b) {
            showError("pythC", "c > b");
            result.value = "Error: c must be greater than b (hypotenuse > side).";
            return;
        }
        a = Math.sqrt(c * c - b * b);
        aInput.value = a.toFixed(4);
        emphasizeInput("pythA"); 

        steps += `Given: b = ${b}, c = ${c}\n`;
        steps += `Formula: a² = c² - b²\n`;
        steps += `a² = ${(c*c).toFixed(4)} - ${(b*b).toFixed(4)}\n`;
        steps += `a² = ${(c*c - b*b).toFixed(4)}\n`;
        steps += `a = √(${(c*c - b*b).toFixed(4)}) = ${a.toFixed(4)}\n`;
    }
    // Case 4: all three given → validate
    else if (!isNaN(a) && !isNaN(b) && !isNaN(c)) {
        let lhs = (a*a + b*b).toFixed(4);
        let rhs = (c*c).toFixed(4);
        if (Math.abs(a*a + b*b - c*c) < 1e-6) {
            steps += `Check: a² + b² = c²\n`;
            steps += `${lhs} = ${rhs} ✅\n`;
            steps += `Values are consistent.`;
        } else {
            steps += `Check: a² + b² = ${lhs}, but c² = ${rhs}\n`;
            steps += `⚠️ Values are NOT consistent.`;
        }
    }
    else {
        showError("pythA", "Need 2 values");
        showError("pythB", "Need 2 values");
        showError("pythC", "Need 2 values");
        result.value = "Provide exactly two sides.";
        return;
    }

    result.value = steps.trim();
    emphasizeResult("pythResult");
    scrollResultToBottom("pythResult");
    }

function clearPythagorean() {
    ["pythA", "pythB", "pythC"].forEach(id => {
        const el = document.getElementById(id);
        el.value = "";
        el.classList.remove("input-flash"); 
    });

    const res = document.getElementById("pythResult");
    res.value = "";
    res.classList.remove("result-flash"); 
}
// Remove emphasize when user changes input manually
["pythA", "pythB", "pythC"].forEach(id => {
    document.getElementById(id).addEventListener("input", function() {
        this.classList.remove("input-flash");
    });
});
// ==== CARD 2: Right Triangle Trigonometry ====
function solveTrigRatios() {
    let aInput = document.getElementById("trigA");
    let bInput = document.getElementById("trigB");
    let cInput = document.getElementById("trigC");
    let AInput = document.getElementById("trigAngleA");
    let funcSelect = document.getElementById("trig-function");
    let result = document.getElementById("trigResult");

    let a = parseFloat(aInput.value);
    let b = parseFloat(bInput.value);
    let c = parseFloat(cInput.value);
    let A = parseFloat(AInput.value);
    let trigChoice = funcSelect.value;

    let steps = "";

    // === Validation: check for missing/invalid inputs ===
    let inputs = [aInput, bInput, cInput, AInput];
    let values = [a, b, c, A];
    let filled = values.filter(v => !isNaN(v)).length;

    // If all inputs are empty → shake only required ones
    if (filled === 0) {
        if (trigChoice === "sin") {
            showError("trigA", "Required");
            showError("trigC", "Required");
            showError("trigAngleA", "Required");
        } else if (trigChoice === "cos") {
            showError("trigB", "Required");
            showError("trigC", "Required");
            showError("trigAngleA", "Required");
        } else if (trigChoice === "tan") {
            showError("trigA", "Required");
            showError("trigB", "Required");
            showError("trigAngleA", "Required");
        }
        result.value = `❌ Enter values for ${trigChoice.toUpperCase()} calculation.`;
        return;
    }

    // If only one input is filled → shake the rest (only required for chosen function)
    if (filled === 1) {
        if (trigChoice === "sin") {
            if (isNaN(a)) showError("trigA", "Required");
            if (isNaN(c)) showError("trigC", "Required");
            if (isNaN(A)) showError("trigAngleA", "Required");
        } else if (trigChoice === "cos") {
            if (isNaN(b)) showError("trigB", "Required");
            if (isNaN(c)) showError("trigC", "Required");
            if (isNaN(A)) showError("trigAngleA", "Required");
        } else if (trigChoice === "tan") {
            if (isNaN(a)) showError("trigA", "Required");
            if (isNaN(b)) showError("trigB", "Required");
            if (isNaN(A)) showError("trigAngleA", "Required");
        }
        result.value = `❌ For ${trigChoice.toUpperCase()}, provide at least two values.`;
        return;
    }

    // Invalid input checks (positive values only)
    if (!isNaN(a) && a <= 0) { showError("trigA", "Invalid"); result.value = "❌ Side a must be positive."; return; }
    if (!isNaN(b) && b <= 0) { showError("trigB", "Invalid"); result.value = "❌ Side b must be positive."; return; }
    if (!isNaN(c) && c <= 0) { showError("trigC", "Invalid"); result.value = "❌ Side c must be positive."; return; }
    if (!isNaN(A) && (A <= 0 || A >= 90)) {
        showError("trigAngleA", "0–90°");
        result.value = "❌ Angle A must be between 0° and 90°.";
        return;
    }

    // === Case 1: Angle given + one side known ===
    if (!isNaN(A)) {
        let rad = A * Math.PI / 180;

        if (trigChoice === "sin") {
            if (isNaN(a) && !isNaN(c)) {
                a = Math.sin(rad) * c;
                aInput.value = a.toFixed(4);
                emphasizeInput("trigA");

                steps += `sin(${A}°) = a/c\n`;
                steps += `a = c × sin(${A}°)\n`;
                steps += `a = ${c} × ${Math.sin(rad).toFixed(4)} = ${a.toFixed(4)}\n`;
            } else if (isNaN(c) && !isNaN(a)) {
                c = a / Math.sin(rad);
                cInput.value = c.toFixed(4);
                emphasizeInput("trigC");

                steps += `sin(${A}°) = a/c\n`;
                steps += `c = a / sin(${A}°)\n`;
                steps += `c = ${a} / ${Math.sin(rad).toFixed(4)} = ${c.toFixed(4)}\n`;
            } else {
                showError("trigA", "Enter side a");
                showError("trigC", "Enter side c");
                result.value = "❌ Provide side a or c with ∠A for sine.";
                return;
            }
        }

        else if (trigChoice === "cos") {
            if (isNaN(b) && !isNaN(c)) {
                b = Math.cos(rad) * c;
                bInput.value = b.toFixed(4);
                emphasizeInput("trigB");

                steps += `cos(${A}°) = b/c\n`;
                steps += `b = c × cos(${A}°)\n`;
                steps += `b = ${c} × ${Math.cos(rad).toFixed(4)} = ${b.toFixed(4)}\n`;
            } else if (isNaN(c) && !isNaN(b)) {
                c = b / Math.cos(rad);
                cInput.value = c.toFixed(4);
                emphasizeInput("trigC");

                steps += `cos(${A}°) = b/c\n`;
                steps += `c = b / cos(${A}°)\n`;
                steps += `c = ${b} / ${Math.cos(rad).toFixed(4)} = ${c.toFixed(4)}\n`;
            } else {
                showError("trigB", "Enter side b");
                showError("trigC", "Enter side c");
                result.value = "❌ Provide side b or c with ∠A for cosine.";
                return;
            }
        }

        else if (trigChoice === "tan") {
            if (isNaN(a) && !isNaN(b)) {
                a = Math.tan(rad) * b;
                aInput.value = a.toFixed(4);
                emphasizeInput("trigA");

                steps += `tan(${A}°) = a/b\n`;
                steps += `a = b × tan(${A}°)\n`;
                steps += `a = ${b} × ${Math.tan(rad).toFixed(4)} = ${a.toFixed(4)}\n`;
            } else if (isNaN(b) && !isNaN(a)) {
                b = a / Math.tan(rad);
                bInput.value = b.toFixed(4);
                emphasizeInput("trigB");

                steps += `tan(${A}°) = a/b\n`;
                steps += `b = a / tan(${A}°)\n`;
                steps += `b = ${a} / ${Math.tan(rad).toFixed(4)} = ${b.toFixed(4)}\n`;
            } else {
                showError("trigA", "Enter side a");
                showError("trigB", "Enter side b");
                result.value = "❌ Provide side a or b with ∠A for tangent.";
                return;
            }
        }
    } 
    // === Case 2: Angle missing, sides given ===
    else {
        if (trigChoice === "sin" && !isNaN(a) && !isNaN(c)) {
            A = Math.asin(a / c) * 180 / Math.PI;
            AInput.value = A.toFixed(2);
            emphasizeInput("trigAngleA");

            steps += `sin(A) = a/c\n`;
            steps += `A = arcsin(${a}/${c})\n`;
            steps += `A = ${A.toFixed(2)}°\n`;
        }
        else if (trigChoice === "cos" && !isNaN(b) && !isNaN(c)) {
            A = Math.acos(b / c) * 180 / Math.PI;
            AInput.value = A.toFixed(2);
            emphasizeInput("trigAngleA");

            steps += `cos(A) = b/c\n`;
            steps += `A = arccos(${b}/${c})\n`;
            steps += `A = ${A.toFixed(2)}°\n`;
        }
        else if (trigChoice === "tan" && !isNaN(a) && !isNaN(b)) {
            A = Math.atan(a / b) * 180 / Math.PI;
            AInput.value = A.toFixed(2);
            emphasizeInput("trigAngleA");

            steps += `tan(A) = a/b\n`;
            steps += `A = atan(${a}/${b})\n`;
            steps += `A = ${A.toFixed(2)}°\n`;
        } else {
            showError("trigAngleA", `Required`);
            result.value = `❌ Not enough data. For ${trigChoice.toUpperCase()}, enter correct sides.`;
            return;
        }
    }

// === Final Output ===
if (steps && steps.trim() !== "") {
    result.value = steps.trim();
    emphasizeResult("trigResult");
    scrollResultToBottom("trigResult");
} else {
    showError("trigResult", "⚠ Not enough valid data to solve");
  }
}

function clearTrigRatios() {
    ["trigA", "trigB", "trigC", "trigAngleA"].forEach(id => {
        const el = document.getElementById(id);
        el.value = "";
        el.classList.remove("input-flash");
    });

    const res = document.getElementById("trigResult");
    res.value = "";
    res.classList.remove("result-flash");
}

// Remove emphasize when user changes input manually
["trigA", "trigB", "trigC", "trigAngleA"].forEach(id => {
    document.getElementById(id).addEventListener("input", function() {
        this.classList.remove("input-flash");
    });
});
const trigSelect = document.getElementById("trig-function");
const inputs = {
  angle: document.getElementById("trigAngleA"),
  a: document.getElementById("trigA"),
  b: document.getElementById("trigB"),
  c: document.getElementById("trigC")
};

function updateHighlight() {
  // Remove old highlights
  Object.values(inputs).forEach(el => el.classList.remove("highlight"));

  const choice = trigSelect.value;
  if (choice === "sin") {
    inputs.angle.classList.add("highlight");
    inputs.a.classList.add("highlight");
    inputs.c.classList.add("highlight");
  } else if (choice === "cos") {
    inputs.angle.classList.add("highlight");
    inputs.b.classList.add("highlight");
    inputs.c.classList.add("highlight");
  } else if (choice === "tan") {
    inputs.angle.classList.add("highlight");
    inputs.a.classList.add("highlight");
    inputs.b.classList.add("highlight");
  }
}

// Run once and on change
trigSelect.addEventListener("change", () => {
  updateHighlight();

  // Remove emphasize from result when dropdown changes
  const res = document.getElementById("trigResult");
  res.classList.remove("result-flash");
  res.value = ""; // optional: clears text too, remove this line if you want to keep text
});

updateHighlight();

// ==== CARD 3: Law of Sines ====
function solveLawOfSines() {
    const aInput = document.getElementById("sineA");
    const bInput = document.getElementById("sineB");
    const cInput = document.getElementById("sineC");
    const AInput = document.getElementById("sineAngleA");
    const BInput = document.getElementById("sineAngleB");
    const CInput = document.getElementById("sineAngleC");
    const resultBox = document.getElementById("sineResult");

    // Remove previous emphasis/error
    [aInput,bInput,cInput,AInput,BInput,CInput].forEach(i => i.classList.remove("input-flash","input-error","shake"));
    resultBox.classList.remove("result-flash");
    resultBox.value = "";

    let a=parseFloat(aInput.value);
    let b=parseFloat(bInput.value);
    let c=parseFloat(cInput.value);
    let A=parseFloat(AInput.value);
    let B=parseFloat(BInput.value);
    let C=parseFloat(CInput.value);

    const degToRad=deg=>deg*Math.PI/180;
    const radToDeg=rad=>rad*180/Math.PI;

    function showError(input,msg){
        input.value="";
        input.placeholder=msg;
        input.classList.add("input-error","shake");
        setTimeout(()=>{input.classList.remove("input-error","shake"); input.placeholder="";},2000);
    }

    try{
        // --- Solve missing angles from known sides & one angle ---
        if (!A && a && b && B) {
            let ratio = a * Math.sin(degToRad(B))/b;
            if(ratio>1||ratio<-1) throw "Invalid triangle";
            A = radToDeg(Math.asin(ratio));
            AInput.value=A.toFixed(4);
            AInput.classList.add("input-flash");
            resultBox.classList.add("result-flash");
            resultBox.value=`Step 1: a/sin(A)=b/sin(B)\nStep 2: sin(A)=a*sin(B)/b\nStep 3: sin(A)=${ratio.toFixed(4)}\nStep 4: A=arcsin(${ratio.toFixed(4)})=${A.toFixed(4)}°`;
        }
        else if (!B && a && b && A) {
            let ratio = b * Math.sin(degToRad(A))/a;
            if(ratio>1||ratio<-1) throw "Invalid triangle";
            B = radToDeg(Math.asin(ratio));
            BInput.value=B.toFixed(4);
            BInput.classList.add("input-flash");
            resultBox.classList.add("result-flash");
            resultBox.value=`Step 1: a/sin(A)=b/sin(B)\nStep 2: sin(B)=b*sin(A)/a\nStep 3: sin(B)=${ratio.toFixed(4)}\nStep 4: B=arcsin(${ratio.toFixed(4)})=${B.toFixed(4)}°`;
        }
        else if (!B && b && c && C) {
            let ratio = b * Math.sin(degToRad(C))/c;
            if(ratio>1||ratio<-1) throw "Invalid triangle";
            B = radToDeg(Math.asin(ratio));
            BInput.value=B.toFixed(4);
            BInput.classList.add("input-flash");
            resultBox.classList.add("result-flash");
            resultBox.value=`Step 1: b/sin(B)=c/sin(C)\nStep 2: sin(B)=b*sin(C)/c\nStep 3: sin(B)=${ratio.toFixed(4)}\nStep 4: B=arcsin(${ratio.toFixed(4)})=${B.toFixed(4)}°`;
        }
        else if (!C && b && c && B) {
            let ratio = c * Math.sin(degToRad(B))/b;
            if(ratio>1||ratio<-1) throw "Invalid triangle";
            C = radToDeg(Math.asin(ratio));
            CInput.value=C.toFixed(4);
            CInput.classList.add("input-flash");
            resultBox.classList.add("result-flash");
            resultBox.value=`Step 1: b/sin(B)=c/sin(C)\nStep 2: sin(C)=c*sin(B)/b\nStep 3: sin(C)=${ratio.toFixed(4)}\nStep 4: C=arcsin(${ratio.toFixed(4)})=${C.toFixed(4)}°`;
        }
        else if (!C && a && c && A) {
            let ratio = c * Math.sin(degToRad(A))/a;
            if(ratio>1||ratio<-1) throw "Invalid triangle";
            C = radToDeg(Math.asin(ratio));
            CInput.value=C.toFixed(4);
            CInput.classList.add("input-flash");
            resultBox.classList.add("result-flash");
            resultBox.value=`Step 1: a/sin(A)=c/sin(C)\nStep 2: sin(C)=c*sin(A)/a\nStep 3: sin(C)=${ratio.toFixed(4)}\nStep 4: C=arcsin(${ratio.toFixed(4)})=${C.toFixed(4)}°`;
        }
        else if (!A && a && c && C) {
            let ratio = a * Math.sin(degToRad(C))/c;
            if(ratio>1||ratio<-1) throw "Invalid triangle";
            A = radToDeg(Math.asin(ratio));
            AInput.value=A.toFixed(4);
            AInput.classList.add("input-flash");
            resultBox.classList.add("result-flash");
            resultBox.value=`Step 1: a/sin(A)=c/sin(C)\nStep 2: sin(A)=a*sin(C)/c\nStep 3: sin(A)=${ratio.toFixed(4)}\nStep 4: A=arcsin(${ratio.toFixed(4)})=${A.toFixed(4)}°`;
        }

        // --- Solve missing sides from known angles & one side ---
        else if (!a && A && b && B) {
            a = b * Math.sin(degToRad(A))/Math.sin(degToRad(B));
            aInput.value=a.toFixed(4);
            aInput.classList.add("input-flash");
            resultBox.classList.add("result-flash");
            resultBox.value=`Step 1: a/sin(A)=b/sin(B)\nStep 2: a=b*sin(A)/sin(B)\nStep 3: a=${a.toFixed(4)}`;
        }
        else if (!b && B && a && A) {
            b = a * Math.sin(degToRad(B))/Math.sin(degToRad(A));
            bInput.value=b.toFixed(4);
            bInput.classList.add("input-flash");
            resultBox.classList.add("result-flash");
            resultBox.value=`Step 1: a/sin(A)=b/sin(B)\nStep 2: b=a*sin(B)/sin(A)\nStep 3: b=${b.toFixed(4)}`;
        }
        else if (!b && B && c && C) {
            b = c * Math.sin(degToRad(B))/Math.sin(degToRad(C));
            bInput.value=b.toFixed(4);
            bInput.classList.add("input-flash");
            resultBox.classList.add("result-flash");
            resultBox.value=`Step 1: b/sin(B)=c/sin(C)\nStep 2: b=c*sin(B)/sin(C)\nStep 3: b=${b.toFixed(4)}`;
        }
        else if (!c && C && b && B) {
            c = b * Math.sin(degToRad(C))/Math.sin(degToRad(B));
            cInput.value=c.toFixed(4);
            cInput.classList.add("input-flash");
            resultBox.classList.add("result-flash");
            resultBox.value=`Step 1: b/sin(B)=c/sin(C)\nStep 2: c=b*sin(C)/sin(B)\nStep 3: c=${c.toFixed(4)}`;
        }
        else if (!c && C && a && A) {
            c = a * Math.sin(degToRad(C))/Math.sin(degToRad(A));
            cInput.value=c.toFixed(4);
            cInput.classList.add("input-flash");
            resultBox.classList.add("result-flash");
            resultBox.value=`Step 1: a/sin(A)=c/sin(C)\nStep 2: c=a*sin(C)/sin(A)\nStep 3: c=${c.toFixed(4)}`;
        }
        else if (!a && A && c && C) {
            a = c * Math.sin(degToRad(A))/Math.sin(degToRad(C));
            aInput.value=a.toFixed(4);
            aInput.classList.add("input-flash");
            resultBox.classList.add("result-flash");
            resultBox.value=`Step 1: a/sin(A)=c/sin(C)\nStep 2: a=c*sin(A)/sin(C)\nStep 3: a=${a.toFixed(4)}`;
        }

        // --- If two angles known, calculate the third angle ---
        else if (!A && B && C) {
            A = 180 - B - C;
            AInput.value = A.toFixed(4);
            AInput.classList.add("input-flash");
            resultBox.classList.add("result-flash");
            resultBox.value = `Step 1: Sum of angles in triangle = 180°\nStep 2: A = 180 - B - C = 180 - ${B} - ${C} = ${A.toFixed(4)}°`;
        }
        else if (!B && A && C) {
            B = 180 - A - C;
            BInput.value = B.toFixed(4);
            BInput.classList.add("input-flash");
            resultBox.classList.add("result-flash");
            resultBox.value = `Step 1: Sum of angles in triangle = 180°\nStep 2: B = 180 - A - C = 180 - ${A} - ${C} = ${B.toFixed(4)}°`;
        }
        else if (!C && A && B) {
            C = 180 - A - B;
            CInput.value = C.toFixed(4);
            CInput.classList.add("input-flash");
            resultBox.classList.add("result-flash");
            resultBox.value = `Step 1: Sum of angles in triangle = 180°\nStep 2: C = 180 - A - B = 180 - ${A} - ${B} = ${C.toFixed(4)}°`;
        }

        else {
            showError(resultBox,"Enter at least 2 known values (1 side + 1 angle) or 2 angles.");
        }
    }
    catch(error){
        showError(resultBox,"Error: Invalid triangle values.");
    }
}

// --- Clear all function ---
function clearLawOfSines() {
    const inputs = ["sineA","sineB","sineC","sineAngleA","sineAngleB","sineAngleC"];
    inputs.forEach(id => {
        const input = document.getElementById(id);
        input.value = "";
        input.classList.remove("input-flash","input-error","shake");
    });
    const resultBox = document.getElementById("sineResult");
    resultBox.value = "";
    resultBox.classList.remove("result-flash");
}

// --- Remove emphasis when any input changes ---
document.querySelectorAll("#sineA, #sineB, #sineC, #sineAngleA, #sineAngleB, #sineAngleC").forEach(input => {
    input.addEventListener("input", () => {
        input.classList.remove("input-flash");
        const resultBox = document.getElementById("sineResult");
        resultBox.classList.remove("result-flash");
        resultBox.value = "";
    });
});

// ==== CARD 4: Law of Cosines ====
function degToRad(deg){ return deg * Math.PI / 180; }
function radToDeg(rad){ return rad * 180 / Math.PI; }

function clearCosineEmphasis() {
  const ids = ["cosA","cosB","cosC","angle"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    el.classList.remove("input-flash","input-error","shake");
  });
  const resultBox = document.getElementById("cosResult");
  resultBox.classList.remove("result-flash");
  // Do not auto-wipe user's work here—only remove emphasis.
}

function showInputError(input, msg){
  const originalValue = input.value;         // Save what user typed
  const originalPlaceholder = input.placeholder; // Save the normal placeholder

  // Show error
  input.value = "";
  input.placeholder = msg;
  input.classList.add("input-error","shake");

  setTimeout(()=>{
    input.classList.remove("input-error","shake");

    if (originalValue) {
      // Restore the user’s previous value if they had entered something
      input.value = originalValue;
    } else {
      // Otherwise restore the normal placeholder
      input.placeholder = originalPlaceholder || "";
    }
  }, 1000);
}

function showResultError(msg){
  const box = document.getElementById("cosResult");
  box.value = ""; // clear previous
  box.placeholder = msg;
  box.classList.add("input-error","shake");
  setTimeout(()=>{
    box.classList.remove("input-error","shake");
    box.placeholder = "Solutions will appear here";
  }, 1000);
}
// ===== Card 4 Emphasis (FIXED) =====
function clearCard4Highlight(){
  ["cosA","cosB","cosC","angle"].forEach(id=>{
    const el = document.getElementById(id);
    if (el) el.classList.remove("highlight");
  });
}

function setCard4RequiredHighlights(){
  const selectEl = document.getElementById("angle-function");
  if (!selectEl) return;
  const sel = selectEl.value; // "Angle A" | "Angle B" | "Angle C"

  clearCard4Highlight();

  // When Angle A is selected -> we need b, c, and the numeric angle input
  if (sel === "Angle A"){
    ["cosB","cosC","angle"].forEach(id=>{
      const el = document.getElementById(id);
      if (el) el.classList.add("highlight");
    });
  }
  // Angle B selected -> need a, c, and the numeric angle input
  else if (sel === "Angle B"){
    ["cosA","cosC","angle"].forEach(id=>{
      const el = document.getElementById(id);
      if (el) el.classList.add("highlight");
    });
  }
  // Angle C selected -> need a, b, and the numeric angle input
  else if (sel === "Angle C"){
    ["cosA","cosB","angle"].forEach(id=>{
      const el = document.getElementById(id);
      if (el) el.classList.add("highlight");
    });
  }
}

// Hook up selection change to highlight the required inputs
const card4Select = document.getElementById("angle-function");
if (card4Select){
  card4Select.addEventListener("change", ()=>{
    // remove any result emphasis (your existing helper)
    clearCosineEmphasis();
    // clear result text
    const resultBox = document.getElementById("cosResult");
    if (resultBox) resultBox.value = "";
    // then show highlights for the newly selected angle
    setCard4RequiredHighlights();
  });

  // Show correct highlights on initial load, too
  setCard4RequiredHighlights();
}

// ✅ FIXED: Do NOT remove highlights when typing
document.querySelectorAll("#cosA, #cosB, #cosC, #angle").forEach(el=>{
  el.addEventListener("input", ()=>{
    clearCosineEmphasis();          // remove result/flash emphasis
    const resultBox = document.getElementById("cosResult");
    if (resultBox) resultBox.value = ""; // clear steps
    // ❌ removed: clearCard4Highlight();
  });
});

// ✅ Call this inside solveLawOfCosines after solving
function afterSolveCard4(){
  clearCard4Highlight();   // remove highlights when clicking Solve
}

// --- Main solver for Card 4 ---
function solveLawOfCosines(){
  const aInput = document.getElementById("cosA");
  const bInput = document.getElementById("cosB");
  const cInput = document.getElementById("cosC");
  const angleInput = document.getElementById("angle");
  const angleSelect = document.getElementById("angle-function");
  const resultBox = document.getElementById("cosResult");
  document.querySelectorAll('.highlight').forEach(el => {
    el.classList.remove('highlight');
  });

  // Reset emphasis (not the values) + clear previous steps
  clearCosineEmphasis();
  resultBox.value = "";

  // Read numbers (NaN if empty)
  let a = parseFloat(aInput.value);
  let b = parseFloat(bInput.value);
  let c = parseFloat(cInput.value);
  let ang = parseFloat(angleInput.value);
  const sel = angleSelect.value; // "Angle A" | "Angle B" | "Angle C"

  // Small validators
  const sideOK = (x)=> typeof x === "number" && isFinite(x) && x>0;
  const angleOK = (x)=> typeof x === "number" && isFinite(x) && x>0 && x<180;

  // Utility: step writer + emphasis
  function writeStepsAndEmphasize(targetInput, steps){
    targetInput.classList.add("input-flash");
    resultBox.classList.add("result-flash");
    resultBox.value = steps.join("\n");
  }

  // Branch per selection: the selected angle’s opposite side is the missing one.
  try {
    if (sel === "Angle A"){
      const missingSide = isNaN(a);
      const haveForSide = sideOK(b) && sideOK(c) && angleOK(ang);

      // Primary path: solve side a from (b, c, A)
      if (missingSide){
        // require B, C, Angle A
        let ok = true;
        if (!sideOK(b)) { showInputError(bInput, "Enter valid side b"); ok=false; }
        if (!sideOK(c)) { showInputError(cInput, "Enter valid side c"); ok=false; }
        if (!angleOK(ang)) { showInputError(angleInput, "Enter valid Angle A (0–180)"); ok=false; }
        if (!ok){ showResultError("Need Angle A, side b, and side c to solve side a."); return; }

        let inside = b*b + c*c - 2*b*c*Math.cos(degToRad(ang));
        if (inside < 0 && inside > -1e-10) inside = 0; // clamp tiny negatives
        if (inside < 0) { showResultError("Invalid values: negative under square root."); return; }

        a = Math.sqrt(inside);
        aInput.value = a.toFixed(4);

        writeStepsAndEmphasize(aInput, [
          "Formula: a² = b² + c² − 2bc·cos(A)",
          `Compute: a = √(b² + c² − 2bc·cos(A))`,
          `       = √(${b}² + ${c}² − 2·${b}·${c}·cos(${ang}))`,
          `       = ${a.toFixed(4)}`
        ]);
        return;
      }

      // Two-way: if Angle A is missing but all three sides are present, solve Angle A
      if (!angleOK(ang) && sideOK(a) && sideOK(b) && sideOK(c)){
        const denom = 2*b*c;
        if (denom === 0){ showResultError("Invalid values: denominator is zero."); return; }
        let cosA = (b*b + c*c - a*a) / denom;
        if (cosA > 1 || cosA < -1){ showResultError("Invalid triangle values (cos out of range)."); return; }
        ang = radToDeg(Math.acos(cosA));
        angleInput.value = ang.toFixed(4);

        writeStepsAndEmphasize(angleInput, [
          "Formula: cos(A) = (b² + c² − a²) / (2bc)",
          `Compute: cos(A) = (${b}² + ${c}² − ${a}²) / (2·${b}·${c}) = ${cosA.toFixed(4)}`,
          `Then: A = arccos(${cosA.toFixed(4)}) = ${ang.toFixed(4)}°`
        ]);
        return;
      }

      // Otherwise, prompt for the primary required inputs
      showResultError("Select Angle A: provide Angle A, side b, and side c to solve side a.");
      // Also nudge empties
      if (!sideOK(b)) showInputError(bInput,"Enter valid side b");
      if (!sideOK(c)) showInputError(cInput,"Enter valid side c");
      if (!angleOK(ang)) showInputError(angleInput,"Enter valid Angle A (0–180)");
      return;
    }

    if (sel === "Angle B"){
      const missingSide = isNaN(b);
      const haveForSide = sideOK(a) && sideOK(c) && angleOK(ang);

      if (missingSide){
        let ok = true;
        if (!sideOK(a)) { showInputError(aInput, "Enter valid side a"); ok=false; }
        if (!sideOK(c)) { showInputError(cInput, "Enter valid side c"); ok=false; }
        if (!angleOK(ang)) { showInputError(angleInput, "Enter valid Angle B (0–180)"); ok=false; }
        if (!ok){ showResultError("Need Angle B, side a, and side c to solve side b."); return; }

        let inside = a*a + c*c - 2*a*c*Math.cos(degToRad(ang));
        if (inside < 0 && inside > -1e-10) inside = 0;
        if (inside < 0) { showResultError("Invalid values: negative under square root."); return; }

        b = Math.sqrt(inside);
        bInput.value = b.toFixed(4);

        writeStepsAndEmphasize(bInput, [
          "Formula: b² = a² + c² − 2ac·cos(B)",
          `Compute: b = √(a² + c² − 2ac·cos(B))`,
          `       = √(${a}² + ${c}² − 2·${a}·${c}·cos(${ang}))`,
          `       = ${b.toFixed(4)}`
        ]);
        return;
      }

      // Two-way: solve Angle B from three sides
      if (!angleOK(ang) && sideOK(a) && sideOK(b) && sideOK(c)){
        const denom = 2*a*c;
        if (denom === 0){ showResultError("Invalid values: denominator is zero."); return; }
        let cosB = (a*a + c*c - b*b) / denom;
        if (cosB > 1 || cosB < -1){ showResultError("Invalid triangle values (cos out of range)."); return; }
        ang = radToDeg(Math.acos(cosB));
        angleInput.value = ang.toFixed(4);

        writeStepsAndEmphasize(angleInput, [
          "Formula: cos(B) = (a² + c² − b²) / (2ac)",
          `Compute: cos(B) = (${a}² + ${c}² − ${b}²) / (2·${a}·${c}) = ${cosB.toFixed(4)}`,
          `Then: B = arccos(${cosB.toFixed(4)}) = ${ang.toFixed(4)}°`
        ]);
        return;
      }

      showResultError("Select Angle B: provide Angle B, side a, and side c to solve side b.");
      if (!sideOK(a)) showInputError(aInput,"Enter valid side a");
      if (!sideOK(c)) showInputError(cInput,"Enter valid side c");
      if (!angleOK(ang)) showInputError(angleInput,"Enter valid Angle B (0–180)");
      return;
    }

    if (sel === "Angle C"){
      const missingSide = isNaN(c);
      const haveForSide = sideOK(a) && sideOK(b) && angleOK(ang);

      if (missingSide){
        let ok = true;
        if (!sideOK(a)) { showInputError(aInput, "Enter valid side a"); ok=false; }
        if (!sideOK(b)) { showInputError(bInput, "Enter valid side b"); ok=false; }
        if (!angleOK(ang)) { showInputError(angleInput, "Enter valid Angle C (0–180)"); ok=false; }
        if (!ok){ showResultError("Need Angle C, side a, and side b to solve side c."); return; }

        let inside = a*a + b*b - 2*a*b*Math.cos(degToRad(ang));
        if (inside < 0 && inside > -1e-10) inside = 0;
        if (inside < 0) { showResultError("Invalid values: negative under square root."); return; }

        c = Math.sqrt(inside);
        cInput.value = c.toFixed(4);

        writeStepsAndEmphasize(cInput, [
          "Formula: c² = a² + b² − 2ab·cos(C)",
          `Compute: c = √(a² + b² − 2ab·cos(C))`,
          `       = √(${a}² + ${b}² − 2·${a}·${b}·cos(${ang}))`,
          `       = ${c.toFixed(4)}`
        ]);
        return;
      }

      // Two-way: solve Angle C from three sides
      if (!angleOK(ang) && sideOK(a) && sideOK(b) && sideOK(c)){
        const denom = 2*a*b;
        if (denom === 0){ showResultError("Invalid values: denominator is zero."); return; }
        let cosC = (a*a + b*b - c*c) / denom;
        if (cosC > 1 || cosC < -1){ showResultError("Invalid triangle values (cos out of range)."); return; }
        ang = radToDeg(Math.acos(cosC));
        angleInput.value = ang.toFixed(4);

        writeStepsAndEmphasize(angleInput, [
          "Formula: cos(C) = (a² + b² − c²) / (2ab)",
          `Compute: cos(C) = (${a}² + ${b}² − ${c}²) / (2·${a}·${b}) = ${cosC.toFixed(4)}`,
          `Then: C = arccos(${cosC.toFixed(4)}) = ${ang.toFixed(4)}°`
        ]);
        return;
      }

      showResultError("Select Angle C: provide Angle C, side a, and side b to solve side c.");
      if (!sideOK(a)) showInputError(aInput,"Enter valid side a");
      if (!sideOK(b)) showInputError(bInput,"Enter valid side b");
      if (!angleOK(ang)) showInputError(angleInput,"Enter valid Angle C (0–180)");
      return;
    }

    // Fallback (shouldn't hit)
    showResultError("Please select Angle A, B, or C.");
  } catch (e){
    showResultError("Error: Invalid triangle values.");
  }
}


function clearLawOfCosines(){
  const ids = ["cosA","cosB","cosC","angle"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    el.value = "";
    el.classList.remove("input-flash","input-error","shake");
  });
  const resultBox = document.getElementById("cosResult");
  resultBox.value = "";
  resultBox.classList.remove("result-flash");
}

// --- Remove emphasis when inputs or angle selection change ---
document.querySelectorAll("#cosA, #cosB, #cosC, #angle").forEach(el=>{
  el.addEventListener("input", ()=>{
    clearCosineEmphasis();
    const resultBox = document.getElementById("cosResult");
    resultBox.value = ""; // clear steps when user edits
  });
});

const angleSelectEl = document.getElementById("angle-function");
if (angleSelectEl){
  angleSelectEl.addEventListener("change", ()=>{
    clearCosineEmphasis();
    const resultBox = document.getElementById("cosResult");
    resultBox.value = ""; // clear steps when changing which angle/side to solve
  });
}
</script>
</body>
</html>